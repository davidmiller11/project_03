<!DOCTYPE html>
<html>
  <head>
    <title>KnowyocityApp</title>
    <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track' => true %>
    <%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>
    <%= csrf_meta_tags %>
    <!-- To load google Maps. -->
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=geometry,places&sensor=false"></script>
    <!-- Load the google maps Places library and Geometry library. To access library, use google.maps.libraryName namespace. -->

    <script type="text/javascript">
      var map;
      var myPlacesService;
      var myRequest;
      var oneSample;
      var oneSampleDetails;

      function initialize() {

        var styleArray = [
          {
            featureType: 'transit',
            elementType: 'all',
            stylers: [
              { visibility: 'off' }
            ]
          },
          {
            featureType: 'poi',
            elementType: 'labels',
            stylers: [
              { visibility: 'off' }
            ]
          }
        ];

        // create a Map options object, with 2 options required for each map: center and zoom.
        var mapOptions = {
          // latitude = y, longitude = x
          center: new google.maps.LatLng( 40.740, -73.977),
          zoom: 14,
          styles: styleArray,
          disableDefaultUI: true,
          draggable: false,
          disableDoubleClickZoom: true,
          keyboardShortcuts: false,
          scrollwheel: false
        };

        map = new google.maps.Map( document.getElementById('map-canvas') , mapOptions );
                
        var clickLatLng;

        google.maps.event.addListener( map, 'click', function(event) {
          clickLatLng = event.latLng;
          console.log( clickLatLng.toString() );
          placeMarker( clickLatLng );

          myRequest = {
            location: clickLatLng,
            radius: '400',
            types: ['restaurant']
          };

          // create new instance of PlacesService class that renders attributions in the specified container.
          myPlacesService = new google.maps.places.PlacesService( map );
          
          myPlacesService.nearbySearch( myRequest, callback );
          // myPlacesService.nearbySearch( )
        });
      }

      function placeMarker( location ) {
        var marker = new google.maps.Marker({
          map: map,
          title: 'My Guess!',
          draggable: false,
          animation: google.maps.Animation.DROP,
          position: location
        });
      }

      function callback( results, status ) {
        if (status == google.maps.places.PlacesServiceStatus.OK) {
          for (var i = 0; i < results.length; i++) {
            console.log( "nearbySearch resp #" + i);
            console.log( results[i] );

          }
          oneSample = results[0].reference;

          myPlacesService.getDetails( { reference: oneSample }, callback2 );
        }
      }

      function callback2( placeResult, status ) {
        if (status == google.maps.places.PlacesServiceStatus.OK) {
            oneSampleDetails = placeResult;
            console.log("DOOOD");
          }
      }

      google.maps.event.addDomListener( window, 'load', initialize);

    </script>
  </head>
  <body>
    <h1>Know Yo City</h1>
    
    <div id="container">
      <%= yield %>
    </div>
    </body>
</html>
